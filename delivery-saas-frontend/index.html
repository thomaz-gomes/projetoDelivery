<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Delivery SaaS ‚Äî Painel</title>

    <!-- ============================ -->
    <!-- üß© Depend√™ncias do QZ Tray -->
    <!-- ============================ -->

    <!-- RSVP (Promise polyfill necess√°rio) -->
    <script src="https://cdn.jsdelivr.net/npm/rsvp@4.8.5/dist/rsvp.min.js"></script>

    <!-- SHA-256 (criptografia usada pelo QZ Tray) -->
    <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/src/sha256.min.js"></script>

    <!-- Adapter: exp√µe `Sha256.hash()` esperado por algumas vers√µes do QZ Tray -->
    <script>
      // Se uma fun√ß√£o global `sha256` estiver dispon√≠vel (do js-sha256), cria um wrapper
      // compat√≠vel com o nome que o qz-tray espera: `Sha256.hash(string) -> hex`.
      (function() {
        try {
          if (typeof Sha256 === 'undefined') {
            if (typeof sha256 === 'function') {
              window.Sha256 = {
                hash: function(data) {
                  return sha256(data);
                }
              };
              console.debug('Adapter: exposto global Sha256.hash usando js-sha256');
            }
          }
        } catch (e) {
          // prote√ß√£o extra para navegadores estranhos ‚Äî n√£o falhar o carregamento
          console.warn('Adapter Sha256 falhou:', e && e.message);
        }
      })();
    </script>

    <!-- Biblioteca principal do QZ Tray -->
    <script src="https://cdn.jsdelivr.net/npm/qz-tray@2.1.0/qz-tray.js"></script>

    <!-- Fallback seguro (em caso de falha de conex√£o) -->
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        if (!window.qz) {
          console.error("‚ùå QZ Tray n√£o carregado. Verifique scripts ou permiss√µes.");
        } else {
          console.log("‚úÖ QZ Tray carregado com sucesso.");
        }

        // Permitir auto-reconex√£o para localhost HTTP (ambiente dev)
        if (window.qz?.security) {
          qz.security.setCertificatePromise((resolve, reject) => {
            // Em dev, usamos o modo sem certificado
            console.warn("‚ö†Ô∏è Usando certificado inseguro (modo DEV).");
            resolve();
          });

          qz.security.setSignaturePromise((toSign) => {
            // Em dev, retorno vazio (sem assinatura)
            return (resolve, reject) => {
              resolve(); // sem assinatura
            };
          });
        }

        // Nota: a inicializa√ß√£o/ conex√£o com QZ Tray √© feita pelo aplicativo Vue
        // (src/plugins/qz.js -> initQZ) para centralizar l√≥gica e evitar
        // tentativas concorrentes vindas de m√∫ltiplos pontos.
      });
    </script>

    <!-- ============================ -->
    <!-- ‚öôÔ∏è Estilos do Vue + App -->
    <!-- ============================ -->
    <script type="module" crossorigin src="/src/main.js"></script>
    <link rel="stylesheet" href="/src/assets/main.css" />
  </head>

  <body>
    <div id="app"></div>
  </body>
</html>